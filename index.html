
<!DOCTYPE html>
<html>
<head>
  <title>Jurnal Guru (Debug)</title>
  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <h2>Form Jurnal Guru</h2>
  <form id="jurnalForm">
    <input type="text" id="nama_guru" placeholder="Nama Guru" required><br>
    <input type="date" id="tanggal" required><br>
    <input type="text" id="kelas" placeholder="Kelas" required><br>
    <input type="text" id="mapel" placeholder="Mapel" required><br>
    <input type="number" id="jam_ke" placeholder="Jam Ke-" required><br>
    <textarea id="materi" placeholder="Materi" required></textarea><br>
    <textarea id="refleksi" placeholder="Refleksi"></textarea><br>
    <button type="submit">Simpan</button>
  </form>

  <p id="status" style="color: red;"></p>

  <h3>Daftar Jurnal</h3>
  <ul id="jurnalList"></ul>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD-F64-CTbjC4TEjkSTcza8lJRmytUGGtU",
      authDomain: "jurnal-guru-app.firebaseapp.com",
      projectId: "jurnal-guru-app",
      storageBucket: "jurnal-guru-app.firebasestorage.app",
      messagingSenderId: "132021751020",
      appId: "1:132021751020:web:732628c375933132d6a9c9",
      measurementId: "G-R1FFDHE8HN"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function tampilkanJurnal() {
      const list = document.getElementById("jurnalList");
      list.innerHTML = "";

      try {
        const snapshot = await db.collection("jurnal").orderBy("tanggal", "desc").get();
        snapshot.forEach(doc => {
          const data = doc.data();
          list.innerHTML += `<li><b>${data.tanggal}</b> - ${data.nama_guru} - ${data.kelas} - ${data.mapel} - Jam ke-${data.jam_ke}<br><i>${data.materi}</i></li><hr>`;
        });
      } catch (error) {
        console.error("Gagal tampilkan data:", error);
        document.getElementById("status").textContent = "Gagal tampilkan data: " + error.message;
      }
    }

    document.getElementById("jurnalForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const status = document.getElementById("status");
      status.textContent = "";

      try {
        await db.collection("jurnal").add({
          nama_guru: document.getElementById("nama_guru").value,
          tanggal: document.getElementById("tanggal").value,
          kelas: document.getElementById("kelas").value,
          mapel: document.getElementById("mapel").value,
          jam_ke: document.getElementById("jam_ke").value,
          materi: document.getElementById("materi").value,
          refleksi: document.getElementById("refleksi").value,
          waktu_input: new Date()
        });
        alert("Jurnal disimpan!");
        document.getElementById("jurnalForm").reset();
        tampilkanJurnal();
      } catch (error) {
        console.error("Gagal simpan jurnal:", error);
        status.textContent = "Gagal simpan jurnal: " + error.message;
      }
    });

    tampilkanJurnal();
  </script>
</body>
</html>
